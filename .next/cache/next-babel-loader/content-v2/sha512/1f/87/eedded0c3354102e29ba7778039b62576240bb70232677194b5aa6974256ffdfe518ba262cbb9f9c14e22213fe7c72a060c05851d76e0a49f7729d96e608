{"ast":null,"code":"// /api/contact\nconst handler = async (req, res) => {\n  if (req.method === 'POST') {\n    const {\n      email,\n      message,\n      name\n    } = req.body;\n\n    if (!email || !email.includes('@') || !name || name.trim() === '' || !message || message.trim() === '') {\n      res.status(422).json({\n        message: 'invalid input'\n      });\n      return;\n    }\n\n    const newMessage = {\n      email,\n      name,\n      message\n    };\n    console.log('ðŸš€ ~ file: contact.js ~ line 13 ~ handler ~ newMessage', newMessage);\n    let client;\n    const connectionString = `mongodb+srv://${process.env.mongodb_username}:${process.env.mongodb_password}@${process.env.mongodb_clustername}.ntrwp.mongodb.net/${process.env.mongodb_database}?retryWrites=true&w=majority`;\n\n    try {\n      client = await MongoClient.connect(connectionString);\n    } catch (error) {\n      res.status(500).json({\n        message: 'Could not connect to database.'\n      });\n      return;\n    }\n\n    const db = client.db();\n\n    try {\n      const result = await db.collection('messages').insertOne(newMessage);\n      newMessage.id = result.insertedId;\n    } catch (error) {\n      client.close();\n      res.status(500).json({\n        message: 'Storing message failed!'\n      });\n      return;\n    }\n\n    client.close();\n    res.status(201).json({\n      message: 'Successfully stored message!',\n      message: newMessage\n    });\n  }\n};\n\nexport default handler;","map":{"version":3,"sources":["/Users/chia/Projects/I/NextJS/nextjs-course/pages/api/contact.js"],"names":["handler","req","res","method","email","message","name","body","includes","trim","status","json","newMessage","console","log","client","connectionString","process","env","mongodb_username","mongodb_password","mongodb_clustername","mongodb_database","MongoClient","connect","error","db","result","collection","insertOne","id","insertedId","close"],"mappings":"AAAA;AAEA,MAAMA,OAAO,GAAG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAChC,MAAID,GAAG,CAACE,MAAJ,KAAe,MAAnB,EAA2B;AACvB,UAAM;AAAEC,MAAAA,KAAF;AAASC,MAAAA,OAAT;AAAkBC,MAAAA;AAAlB,QAA2BL,GAAG,CAACM,IAArC;;AAEA,QAAI,CAACH,KAAD,IAAU,CAACA,KAAK,CAACI,QAAN,CAAe,GAAf,CAAX,IAAkC,CAACF,IAAnC,IAA2CA,IAAI,CAACG,IAAL,OAAgB,EAA3D,IAAiE,CAACJ,OAAlE,IAA6EA,OAAO,CAACI,IAAR,OAAmB,EAApG,EAAwG;AACpGP,MAAAA,GAAG,CAACQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEN,QAAAA,OAAO,EAAE;AAAX,OAArB;AACA;AACH;;AAED,UAAMO,UAAU,GAAG;AACfR,MAAAA,KADe;AAEfE,MAAAA,IAFe;AAGfD,MAAAA;AAHe,KAAnB;AAKAQ,IAAAA,OAAO,CAACC,GAAR,CAAY,wDAAZ,EAAsEF,UAAtE;AAEA,QAAIG,MAAJ;AAEA,UAAMC,gBAAgB,GAAI,iBAAgBC,OAAO,CAACC,GAAR,CAAYC,gBAAiB,IAAGF,OAAO,CAACC,GAAR,CAAYE,gBAAiB,IAAGH,OAAO,CAACC,GAAR,CAAYG,mBAAoB,sBAAqBJ,OAAO,CAACC,GAAR,CAAYI,gBAAiB,8BAA5L;;AAEA,QAAI;AACAP,MAAAA,MAAM,GAAG,MAAMQ,WAAW,CAACC,OAAZ,CAAoBR,gBAApB,CAAf;AACH,KAFD,CAEE,OAAOS,KAAP,EAAc;AACZvB,MAAAA,GAAG,CAACQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEN,QAAAA,OAAO,EAAE;AAAX,OAArB;AACA;AACH;;AAED,UAAMqB,EAAE,GAAGX,MAAM,CAACW,EAAP,EAAX;;AAEA,QAAI;AACA,YAAMC,MAAM,GAAG,MAAMD,EAAE,CAACE,UAAH,CAAc,UAAd,EAA0BC,SAA1B,CAAoCjB,UAApC,CAArB;AACAA,MAAAA,UAAU,CAACkB,EAAX,GAAgBH,MAAM,CAACI,UAAvB;AACH,KAHD,CAGE,OAAON,KAAP,EAAc;AACZV,MAAAA,MAAM,CAACiB,KAAP;AACA9B,MAAAA,GAAG,CAACQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEN,QAAAA,OAAO,EAAE;AAAX,OAArB;AACA;AACH;;AAEDU,IAAAA,MAAM,CAACiB,KAAP;AAEA9B,IAAAA,GAAG,CAACQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEN,MAAAA,OAAO,EAAE,8BAAX;AAA2CA,MAAAA,OAAO,EAAEO;AAApD,KAArB;AACH;AACJ,CA1CD;;AA4CA,eAAeZ,OAAf","sourcesContent":["// /api/contact\n\nconst handler = async (req, res) => {\n    if (req.method === 'POST') {\n        const { email, message, name } = req.body\n\n        if (!email || !email.includes('@') || !name || name.trim() === '' || !message || message.trim() === '') {\n            res.status(422).json({ message: 'invalid input' })\n            return\n        }\n\n        const newMessage = {\n            email,\n            name,\n            message,\n        }\n        console.log('ðŸš€ ~ file: contact.js ~ line 13 ~ handler ~ newMessage', newMessage)\n\n        let client\n\n        const connectionString = `mongodb+srv://${process.env.mongodb_username}:${process.env.mongodb_password}@${process.env.mongodb_clustername}.ntrwp.mongodb.net/${process.env.mongodb_database}?retryWrites=true&w=majority`\n\n        try {\n            client = await MongoClient.connect(connectionString)\n        } catch (error) {\n            res.status(500).json({ message: 'Could not connect to database.' })\n            return\n        }\n\n        const db = client.db()\n\n        try {\n            const result = await db.collection('messages').insertOne(newMessage)\n            newMessage.id = result.insertedId\n        } catch (error) {\n            client.close()\n            res.status(500).json({ message: 'Storing message failed!' })\n            return\n        }\n\n        client.close()\n\n        res.status(201).json({ message: 'Successfully stored message!', message: newMessage })\n    }\n}\n\nexport default handler\n"]},"metadata":{},"sourceType":"module"}